#!/bin/bash

# VastVideo-Go å¯åŠ¨è„šæœ¬
# å…ˆç¼–è¯‘ï¼Œå†å¯åŠ¨

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "ğŸš€ VastVideo-Go å¯åŠ¨è„šæœ¬å¼€å§‹æ‰§è¡Œ..."
echo "=================================="

# æ£€æŸ¥ Go ç¯å¢ƒ
if ! command -v go &> /dev/null; then
    echo "âŒ é”™è¯¯: æœªæ‰¾åˆ° Go ç¯å¢ƒï¼Œè¯·å…ˆå®‰è£… Go"
    exit 1
fi

echo "âœ… Go ç¯å¢ƒæ£€æŸ¥é€šè¿‡: $(go version)"

# æ¸…ç†æ—§çš„ç¼–è¯‘æ–‡ä»¶
echo "ğŸ§¹ æ¸…ç†æ—§çš„ç¼–è¯‘æ–‡ä»¶..."
rm -f vastvideo-go
rm -f *.exe

# ç¼–è¯‘é¡¹ç›®
echo "ğŸ”¨ å¼€å§‹ç¼–è¯‘é¡¹ç›®..."
if go build -o vastvideo-go .; then
    echo "âœ… ç¼–è¯‘æˆåŠŸ!"
else
    echo "âŒ ç¼–è¯‘å¤±è´¥!"
    exit 1
fi

# æ£€æŸ¥ç¼–è¯‘åçš„æ–‡ä»¶
if [ ! -f "vastvideo-go" ]; then
    echo "âŒ é”™è¯¯: ç¼–è¯‘åçš„æ–‡ä»¶ä¸å­˜åœ¨"
    exit 1
fi

echo "ğŸ“¦ ç¼–è¯‘å®Œæˆï¼Œæ–‡ä»¶å¤§å°: $(du -h vastvideo-go | cut -f1)"

# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x vastvideo-go

echo "=================================="
echo "ğŸ¯ å¼€å§‹å¯åŠ¨ VastVideo-Go æœåŠ¡..."
echo "=================================="

# å¯åŠ¨æœåŠ¡
./vastvideo-go "$@"

echo "=================================="
echo "ğŸ‘‹ VastVideo-Go æœåŠ¡å·²é€€å‡º"
echo "==================================" 